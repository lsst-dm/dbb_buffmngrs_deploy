version: "3.6"
services:
  at-dbbbm:
    image: lsstts/dbbbm:${TAG}
    command: ["./local/etc/at_dbbbm_config.yaml"]
    environment:
      - GRP_ID
      - USR_ID
    volumes:
      - type: bind
        source: /data
        target: /data
      - type: bind
        source: /var/log
        target: /var/log
      - type: bind
        source: ./etc
        target: /home/mgr/local/etc
      - type: bind
        source: ${HOME}/.ssh
        target: /tmp/.ssh
        read_only: true
    depends_on:
      - dbbbm
  cc-dbbbm:
    image: lsstts/dbbbm:${TAG}
    command: ["./local/etc/cc_dbbbm_config.yaml"]
    environment:
      - GRP_ID
      - USR_ID
    volumes:
      - type: bind
        source: /data
        target: /data
      - type: bind
        source: /var/log
        target: /var/log
      - type: bind
        source: ./etc
        target: /home/mgr/local/etc
      - type: bind
        source: ${HOME}/.ssh
        target: /tmp/.ssh
        read_only: true
    user: ${USR_ID}:${GRP_ID}
    depends_on:
      - dbbbm
  dbbbm:
    image: lsstts/dbbbm:${TAG}
    build:
      context: ./dbbbm
      args:
        - LSST_VER
        - MNGR_VER
      network: host
